"use strict";(self.webpackChunkdr_pe_ui_storybook=self.webpackChunkdr_pe_ui_storybook||[]).push([[7800],{"./src/Components/Choose/CheckTree/Hooks/useCheckTree.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>Action_Type,_:()=>useCheckTree});var react=__webpack_require__("./node_modules/react/index.js"),src=__webpack_require__("./src/index.ts"),initValues=function initValues(values){for(var data={},arr=null!=values?values:[],i=0;i<arr.length;i++)data[arr[i]]=!0;return data};try{initValues.displayName="initValues",initValues.__docgenInfo={description:"将values转化为 键:boolean的形式\n方便后面的运行",displayName:"initValues",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Components/Choose/CheckTree/Unit/mapValues.tsx#initValues"]={docgenInfo:initValues.__docgenInfo,name:"initValues",path:"src/Components/Choose/CheckTree/Unit/mapValues.tsx#initValues"})}catch(__react_docgen_typescript_loader_error){}var Action_Type=function(Action_Type){return Action_Type.SwitchItemCheckStatus="SWITCHITEMCHECKSTATUS",Action_Type.removeItem="REMOVEITEM",Action_Type}({}),useCheckTree=function useCheckTree(values,handleValuesChange){var checkedDataRef=(0,react.useRef)(initValues(values));(0,src.rfj)((function(){checkedDataRef.current=initValues(values)}),[values]);var diffValues=function diffValues(){var data=initValues(values);if(JSON.stringify(data)!==JSON.stringify(checkedDataRef.current)){var arr=[];for(var key in checkedDataRef.current){checkedDataRef.current[key]&&arr.push(key)}null==handleValuesChange||handleValuesChange(arr)}};return[function fn(action){switch(action.type){case Action_Type.SwitchItemCheckStatus:checkedDataRef.current[action.payload.id]=action.payload.value,diffValues();break;case Action_Type.removeItem:delete checkedDataRef.current[action.payload.id],diffValues()}},checkedDataRef]}},"./src/Components/Choose/CheckTree/Unit/context.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EJ:()=>useCheckTreeContext,S1:()=>CheckTreeState,fJ:()=>useCheckTreePostMsg,kv:()=>CheckTreePostMsg,lw:()=>CheckTreeContext,sv:()=>useCheckTreeState});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),CheckTreeContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)({}),useCheckTreeContext=function useCheckTreeContext(){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(CheckTreeContext)},CheckTreeState=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)({checkedDataRef:{current:{}},dispatch:function dispatch(){}}),useCheckTreeState=function useCheckTreeState(){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(CheckTreeState)},CheckTreePostMsg=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)({deep:0,pId:"-1",siblings:{current:[]}}),useCheckTreePostMsg=function useCheckTreePostMsg(){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(CheckTreePostMsg)};try{CheckTreePostMsg.displayName="CheckTreePostMsg",CheckTreePostMsg.__docgenInfo={description:"父子通讯的唯一桥梁",displayName:"CheckTreePostMsg",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Components/Choose/CheckTree/Unit/context.tsx#CheckTreePostMsg"]={docgenInfo:CheckTreePostMsg.__docgenInfo,name:"CheckTreePostMsg",path:"src/Components/Choose/CheckTree/Unit/context.tsx#CheckTreePostMsg"})}catch(__react_docgen_typescript_loader_error){}},"./src/Components/Choose/CheckTree/Unit/item.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>item});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),react=__webpack_require__("./node_modules/react/index.js"),src=__webpack_require__("./src/index.ts"),classNames=__webpack_require__("./src/Unit/classNames.ts"),readChild=__webpack_require__("./src/Unit/readChild.ts"),context=__webpack_require__("./src/Components/Choose/CheckTree/Unit/context.tsx"),useLatest=__webpack_require__("./src/Hooks/useLatest.ts"),useCheckTree=__webpack_require__("./src/Components/Choose/CheckTree/Hooks/useCheckTree.ts"),getChildStatus=function getChildStatus(subChild,checkedData){for(var allCheck=!0,allNoCheck=!0,i=0;i<subChild.length;i++){checkedData[subChild[i]]?allNoCheck=!1:allCheck=!1}return allCheck?1:allNoCheck?0:2},PostMsgActionType=function(PostMsgActionType){return PostMsgActionType.changeParentCheckStatus="CHANGEPARENTCHECKSTATUS",PostMsgActionType.changeChildCheckStatus="CHANGECHILDCHECKSTATUS",PostMsgActionType}({}),useMsg=function useMsg(uuid,setChecked,setChildStatus,isLeaf){var msgId=(0,react.useId)(),pMsgId=(0,context.fJ)().pMsgId,checkedDataRef=(0,context.sv)().checkedDataRef,setCheckedRef=(0,useLatest.d)(setChecked),subChild=(0,react.useRef)([]),setChildStatusRef=(0,react.useRef)(setChildStatus),uuidRef=(0,useLatest.d)(uuid),isLeafRef=(0,useLatest.d)(isLeaf),pMsgIdRef=(0,useLatest.d)(pMsgId);return(0,react.useLayoutEffect)((function(){var fn=function fn(e){var eventData=e.detail;if(eventData.action===PostMsgActionType.changeChildCheckStatus)isLeafRef.current?(setCheckedRef.current(eventData.value),function postMsgToParent(event){if(pMsgIdRef.current){var msgEvent=new CustomEvent(pMsgIdRef.current,{detail:{action:PostMsgActionType.changeParentCheckStatus,value:event.value,isClick:event.isClick,key:uuidRef.current}});document.dispatchEvent(msgEvent)}}(eventData)):function postMsgToChild(event){var msgEvent=new CustomEvent(msgId,{detail:(0,src.Wgt)(event)});document.dispatchEvent(msgEvent)}(eventData)};return pMsgId&&document.addEventListener(pMsgId,fn),function(){pMsgId&&document.removeEventListener(pMsgId,fn)}}),[pMsgId,msgId]),(0,react.useLayoutEffect)((function(){var mapChild=function mapChild(eventData){if(eventData.isClick&&eventData.key){var status=getChildStatus(subChild.current,checkedDataRef.current),value=1===status;setChildStatusRef.current(status),setCheckedRef.current(value),function postMsgToParent(event){if(pMsgIdRef.current){var msgEvent=new CustomEvent(pMsgIdRef.current,{detail:{action:PostMsgActionType.changeParentCheckStatus,isClick:event.isClick,key:uuidRef.current}});document.dispatchEvent(msgEvent)}}(eventData)}},fn=function fn(e){var eventData=e.detail;if(eventData.action===PostMsgActionType.changeParentCheckStatus)mapChild(eventData)};return document.addEventListener(msgId,fn),function(){document.removeEventListener(msgId,fn)}}),[msgId]),[msgId,subChild]};const style_module_checkTreeItem_main="style_checkTreeItem_main__P3XD2",style_module_checkTreeItem_openBtn="style_checkTreeItem_openBtn__gIUvS",style_module_checkTreeItem_openBtnActive="style_checkTreeItem_openBtnActive__I8cR1",style_module_checkTreeItem_openIcon="style_checkTreeItem_openIcon__BMNSj",style_module_checkTreeItem_wrapper="style_checkTreeItem_wrapper__O28S9",style_module_checkTreeItem_subItems="style_checkTreeItem_subItems__a39+h",style_module_checkTreeItem_checkBtn="style_checkTreeItem_checkBtn__3921y",style_module_checkTreeItem_noActiveIcon="style_checkTreeItem_noActiveIcon__mlCnD",style_module_checkTreeItem_activeIcon="style_checkTreeItem_activeIcon__N7otb",style_module_checkTreeItem_halfActiveIcon="style_checkTreeItem_halfActiveIcon__gv+wQ",style_module_checkTreeItem_checkBtnActive="style_checkTreeItem_checkBtnActive__z95kr",style_module_checkTreeItem_checkBtnActive__half="style_checkTreeItem_checkBtnActive__half__iXn9-",style_module_checkTreeItem_content="style_checkTreeItem_content__V4tm2";var toAnimate=__webpack_require__("./src/Components/Choose/CheckTree/Unit/toAnimate.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Unit_checkBtn=function Temp(_ref){var uuid=_ref.uuid,disable=_ref.disable,handleStatusChange=_ref.handleStatusChange,msgId=_ref.msgId,checked=_ref.checked,hasSubItem=_ref.hasSubItem,childStatus=_ref.childStatus,checkedDataRef=(0,context.sv)().checkedDataRef,pMsgId=(0,context.fJ)().pMsgId,checkRef=(0,react.useRef)(null);return(0,jsx_runtime.jsxs)("div",{className:(0,classNames.Z)(style_module_checkTreeItem_checkBtn,function isActive(){return checked?style_module_checkTreeItem_checkBtnActive:2===childStatus?style_module_checkTreeItem_checkBtnActive__half:void 0}()),onClick:function handleClick(){if(!disable){var status=!checkedDataRef.current[uuid];checkRef.current&&(0,toAnimate.T)(checkRef.current,status),hasSubItem?function postMessageToChild(status){var msgEvent=new CustomEvent(msgId,{detail:{action:PostMsgActionType.changeChildCheckStatus,value:status,isClick:!0}});document.dispatchEvent(msgEvent)}(status):(handleStatusChange(status),function postMessageToParent(status){if(pMsgId){var msgEvent=new CustomEvent(pMsgId,{detail:{action:PostMsgActionType.changeParentCheckStatus,key:uuid,value:status,isClick:!0}});document.dispatchEvent(msgEvent)}}(status))}},children:[(0,jsx_runtime.jsx)(src.JO$,{type:"checkboxEmpty",className:style_module_checkTreeItem_noActiveIcon}),(0,jsx_runtime.jsx)(src.JO$,{type:"checkboxSolid",className:style_module_checkTreeItem_activeIcon,ref:checkRef}),(0,jsx_runtime.jsx)(src.JO$,{type:"writer",className:style_module_checkTreeItem_halfActiveIcon})]})};try{checkBtn.displayName="checkBtn",checkBtn.__docgenInfo={description:"",displayName:"checkBtn",props:{hasSubItem:{defaultValue:null,description:"",name:"hasSubItem",required:!0,type:{name:"boolean"}},uuid:{defaultValue:null,description:"id",name:"uuid",required:!0,type:{name:"string"}},disable:{defaultValue:null,description:"是否禁用",name:"disable",required:!0,type:{name:"boolean"}},handleStatusChange:{defaultValue:null,description:"当活跃状态被改变时",name:"handleStatusChange",required:!0,type:{name:"(res: boolean) => void"}},msgId:{defaultValue:null,description:"通讯id",name:"msgId",required:!0,type:{name:"string"}},checked:{defaultValue:null,description:"当前是否被选中",name:"checked",required:!0,type:{name:"boolean"}},childStatus:{defaultValue:null,description:"子集选中的状态",name:"childStatus",required:!0,type:{name:"enum",value:[{value:"0"},{value:"2"},{value:"1"}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Components/Choose/CheckTree/Unit/checkBtn.tsx#checkBtn"]={docgenInfo:checkBtn.__docgenInfo,name:"checkBtn",path:"src/Components/Choose/CheckTree/Unit/checkBtn.tsx#checkBtn"})}catch(__react_docgen_typescript_loader_error){}var _excluded=["className","children","open","content","active","uuid","handleOpenChange","handleActiveChange","disable","isLeaf"],item_Temp=function Temp(_ref,events){var className=_ref.className,children=_ref.children,_ref$open=_ref.open,open=void 0!==_ref$open&&_ref$open,content=_ref.content,active=_ref.active,uuid=_ref.uuid,handleOpenChange=_ref.handleOpenChange,handleActiveChange=_ref.handleActiveChange,disable=_ref.disable,isLeaf=_ref.isLeaf,props=(0,objectWithoutProperties.Z)(_ref,_excluded),_useCheckTreeContext=(0,context.EJ)(),globalDisable=_useCheckTreeContext.disable,values=_useCheckTreeContext.values,_useChangeCheck=function useChangeCheck(uuid,active){var _ref,values=(0,context.EJ)().values,_useState=(0,react.useState)(null!==(_ref=null!=active?active:null==values?void 0:values.includes(uuid))&&void 0!==_ref&&_ref),_useState2=(0,slicedToArray.Z)(_useState,2),checked=_useState2[0],setChecked=_useState2[1],uuidLast=(0,useLatest.d)(uuid),dispatch=(0,context.sv)().dispatch,dispatchRef=(0,useLatest.d)(dispatch);return(0,react.useEffect)((function(){var _values$includes,status=active;"boolean"!=typeof status&&(status=null!==(_values$includes=null==values?void 0:values.includes(uuidLast.current))&&void 0!==_values$includes&&_values$includes),setChecked(status),dispatchRef.current({type:useCheckTree.T.SwitchItemCheckStatus,payload:{id:uuidLast.current,value:status}})}),[active,values]),[checked,function changeFn(status){setChecked(status),dispatchRef.current({type:useCheckTree.T.SwitchItemCheckStatus,payload:{id:uuidLast.current,value:status}})}]}(uuid,active),_useChangeCheck2=(0,slicedToArray.Z)(_useChangeCheck,2),checked=_useChangeCheck2[0],setChecked=_useChangeCheck2[1],_useState=(0,react.useState)(0),_useState2=(0,slicedToArray.Z)(_useState,2),childStatus=_useState2[0],setChildStatus=_useState2[1],_useState3=(0,react.useState)(open),_useState4=(0,slicedToArray.Z)(_useState3,2),openState=_useState4[0],setOpenState=_useState4[1],disableVal=(0,react.useMemo)((function(){return null!=disable?disable:globalDisable}),[globalDisable,disable]),AutoIsLeaf=(0,react.useMemo)((function(){return!(0,readChild.Z)(children).some((function(item){return item.displayName===CheckTreeItem.displayName}))}),[children]),_useCheckTreePostMsg=(0,context.fJ)(),deep=_useCheckTreePostMsg.deep,siblings=_useCheckTreePostMsg.siblings,_useCheckTreeState=(0,context.sv)(),dispatch=_useCheckTreeState.dispatch,checkedDataRef=_useCheckTreeState.checkedDataRef,dispatchRef=(0,useLatest.d)(dispatch),uuidRef=(0,react.useRef)({from:void 0,to:void 0}),_useMsg=useMsg(uuid,(function(res){setChecked(res),null==handleActiveChange||handleActiveChange(res),dispatch({type:useCheckTree.T.SwitchItemCheckStatus,payload:{value:res,id:uuid}})}),setChildStatus,null!=isLeaf?isLeaf:AutoIsLeaf),_useMsg2=(0,slicedToArray.Z)(_useMsg,2),msgId=_useMsg2[0],subChild=_useMsg2[1];(0,src.rfj)((function(){setOpenState(open)}),[open]),(0,react.useEffect)((function(){setChildStatus(getChildStatus(subChild.current,checkedDataRef.current))}),[uuid,active,values]),(0,react.useEffect)((function(){uuidRef.current.from&&dispatchRef.current({type:useCheckTree.T.removeItem,payload:{id:uuidRef.current.from}}),uuidRef.current.from=uuidRef.current.to,uuidRef.current.to=uuid}),[uuid]),(0,react.useEffect)((function(){for(var fromIndex=-1,toIndex=-1,i=0;i<siblings.current.length;++i){var item=siblings.current[i];item===uuidRef.current.from?fromIndex=i:item===uuidRef.current.to&&(toIndex=i)}toIndex<0&&siblings.current.push(uuid),fromIndex>=0&&siblings.current.splice(fromIndex,1)}),[uuid]),(0,react.useImperativeHandle)(events,(function(){return{changeOpenStatus:function changeOpenStatus(res){setOpenState(res)},changeActiveStatus:function changeActiveStatus(res){setChecked(res)}}}));var openBtn=(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});(null!=isLeaf?isLeaf:AutoIsLeaf)||(openBtn=(0,jsx_runtime.jsx)("div",{className:(0,classNames.Z)(style_module_checkTreeItem_openBtn,(0,defineProperty.Z)({},style_module_checkTreeItem_openBtnActive,openState)),onClick:function handleOpenBtnClick(){disableVal||setOpenState((function(pre){return null==handleOpenChange||handleOpenChange(!pre),!pre}))},children:(0,jsx_runtime.jsx)(src.JO$,{type:"next",className:style_module_checkTreeItem_openIcon})}));var paddingLeft="";return deep&&(paddingLeft+="calc(4rem",deep-1>0&&(paddingLeft+=" + 2rem * ".concat(deep-1)),paddingLeft+=(null!=isLeaf?isLeaf:AutoIsLeaf)?")":" - 0.4rem - 2rem)"),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",(0,objectSpread2.Z)((0,objectSpread2.Z)({className:(0,classNames.Z)(style_module_checkTreeItem_wrapper,className)},props),{},{children:(0,jsx_runtime.jsxs)("div",{className:style_module_checkTreeItem_main,style:{paddingLeft},children:[openBtn,(0,jsx_runtime.jsx)(Unit_checkBtn,{msgId,uuid,hasSubItem:!(null!=isLeaf?isLeaf:AutoIsLeaf),checked,childStatus,disable:null!=disableVal&&disableVal,handleStatusChange:function handleStatusChange(res){null==handleActiveChange||handleActiveChange(res),setChecked(res),dispatch({type:useCheckTree.T.SwitchItemCheckStatus,payload:{value:res,id:uuid}})}}),(0,jsx_runtime.jsx)("div",{className:style_module_checkTreeItem_content,children:content})]})})),(null!=isLeaf?isLeaf:AutoIsLeaf)?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}):(0,jsx_runtime.jsx)(src.uTP,{show:openState,removeOnHidden:!1,cache:!1,animationType:"taller",className:style_module_checkTreeItem_subItems,children:(0,jsx_runtime.jsx)(context.kv.Provider,{value:{deep:deep+1,pId:uuid,siblings:subChild,pMsgId:msgId},children})})]})},CheckTreeItem=(0,react.forwardRef)(item_Temp);CheckTreeItem.displayName="CheckTreeItem";const item=CheckTreeItem;try{CheckTreeItem.displayName="CheckTreeItem",CheckTreeItem.__docgenInfo={description:"",displayName:"CheckTreeItem",props:{children:{defaultValue:null,description:"当children有值时\n会被识别为有子item",name:"children",required:!1,type:{name:"ReactNode"}},content:{defaultValue:null,description:"当前item的内容",name:"content",required:!1,type:{name:"ReactNode"}},open:{defaultValue:{value:"false"},description:"是否展开\n当有children的时候",name:"open",required:!1,type:{name:"boolean"}},active:{defaultValue:null,description:"当前是否被选中\n* 默认值为false",name:"active",required:!1,type:{name:"boolean"}},uuid:{defaultValue:null,description:"唯一标识",name:"uuid",required:!0,type:{name:"string"}},handleOpenChange:{defaultValue:null,description:"当打开状态被改变时",name:"handleOpenChange",required:!1,type:{name:"((openValue: boolean) => void)"}},handleActiveChange:{defaultValue:null,description:"当选中状态被改变时",name:"handleActiveChange",required:!1,type:{name:"((activeChange: boolean) => void)"}},disable:{defaultValue:null,description:"是否时禁用 的",name:"disable",required:!1,type:{name:"boolean"}},isLeaf:{defaultValue:null,description:'是否为最后一个子级\n不会再有子\n\n* 默认自动判断 但是如果children里是自己封装的组件，无法对自定义封装的组件进行结构\n* 所以如果是自定义封装的组件,请自行传入 是否为"树叶"的属性',name:"isLeaf",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Components/Choose/CheckTree/Unit/item.tsx#CheckTreeItem"]={docgenInfo:CheckTreeItem.__docgenInfo,name:"CheckTreeItem",path:"src/Components/Choose/CheckTree/Unit/item.tsx#CheckTreeItem"})}catch(__react_docgen_typescript_loader_error){}},"./src/Components/Choose/CheckTree/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var C_Users_zmz_Documents_GitHub_dr_Front_ComponentStoryBook_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),_Hooks_useCheckTree__WEBPACK_IMPORTED_MODULE_1__=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./src/Components/Choose/CheckTree/Hooks/useCheckTree.ts")),_Unit_context__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/Components/Choose/CheckTree/Unit/context.tsx"),_Unit_item__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/Components/Choose/CheckTree/Unit/item.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/jsx-runtime.js"),CheckTree=function CheckTree(_ref){var children=_ref.children,disable=_ref.disable,values=_ref.values,handleValuesChange=_ref.handleValuesChange,_useCheckTree=(0,_Hooks_useCheckTree__WEBPACK_IMPORTED_MODULE_1__._)(values,handleValuesChange),_useCheckTree2=(0,C_Users_zmz_Documents_GitHub_dr_Front_ComponentStoryBook_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_5__.Z)(_useCheckTree,2),dispatch=_useCheckTree2[0],checkedDataRef=_useCheckTree2[1];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Unit_context__WEBPACK_IMPORTED_MODULE_2__.lw.Provider,{value:{disable,values},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_Unit_context__WEBPACK_IMPORTED_MODULE_2__.S1.Provider,{value:{dispatch,checkedDataRef},children})})};CheckTree.Item=_Unit_item__WEBPACK_IMPORTED_MODULE_3__.Z;const __WEBPACK_DEFAULT_EXPORT__=CheckTree}}]);